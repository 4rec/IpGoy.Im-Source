<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASN Lookup | ipgoy.im</title>
    <link rel="stylesheet" href="https://ipgoy.im/styles.css">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .result-box {
            margin-top: 20px;
            display: none;
        }
        .error-box {
            margin-top: 20px;
            display: none;
            background-color: var(--active-link);
            color: white;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
        }
        .site-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .site-logo {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: var(--header-bg);
            margin-bottom: 10px;
        }
        .loading {
            display: none;
            margin: 10px 0;
            font-style: italic;
        }
        .asn-info {
            margin-bottom: 15px;
            padding: 10px;
            background-color: var(--table-row-odd);
            border: 1px solid var(--table-border);
        }
        .info-section {
            margin-bottom: 15px;
        }
        .info-section h3 {
            border-bottom: 1px solid var(--text-color);
            padding-bottom: 3px;
            margin-bottom: 8px;
        }
        .flag-emoji {
            font-size: 20px;
            margin-right: 5px;
        }
        .badge {
            display: inline-block;
            padding: 2px 5px;
            background-color: var(--header-bg);
            color: var(--header-text);
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="https://ipgoy.im">Home</a>
    </div>

    <div class="container">
        <div class="site-header">
            <div class="site-logo">ipgoy.im</div>
            <h1>ASN Lookup (CAIDA ASRank)</h1>
        </div>
        
        <div class="box">
            <div class="box-title">Search ASN</div>
            <div class="form-group">
                <label for="asn-number">ASN Number (e.g., 214575):</label>
                <input type="text" id="asn-number" placeholder="Enter ASN number...">
            </div>
            <button id="lookup-btn">Lookup ASN</button>
            <div id="loading" class="loading">Fetching ASN information...</div>
        </div>

        <div id="error-box" class="box error-box">
            <div class="box-title">Error</div>
            <div id="error-message"></div>
        </div>

        <div id="result-box" class="box result-box">
            <div class="box-title">ASN Information</div>
            <div id="result-content">
                <div class="asn-info">
                    <h2 id="asn-title"></h2>
                    <div id="asn-basic"></div>
                </div>
                
                <div class="info-section">
                    <h3>Network Cone</h3>
                    <table>
                        <tr>
                            <td><strong>ASNs</strong></td>
                            <td id="cone-asns"></td>
                        </tr>
                        <tr>
                            <td><strong>Prefixes</strong></td>
                            <td id="cone-prefixes"></td>
                        </tr>
                        <tr>
                            <td><strong>Addresses</strong></td>
                            <td id="cone-addresses"></td>
                        </tr>
                    </table>
                </div>
                
                <div class="info-section">
                    <h3>Peering Relationships</h3>
                    <table>
                        <tr>
                            <td><strong>Total</strong></td>
                            <td id="degree-total"></td>
                        </tr>
                        <tr>
                            <td><strong>Customers</strong></td>
                            <td id="degree-customer"></td>
                        </tr>
                        <tr>
                            <td><strong>Peers</strong></td>
                            <td id="degree-peer"></td>
                        </tr>
                        <tr>
                            <td><strong>Providers</strong></td>
                            <td id="degree-provider"></td>
                        </tr>
                    </table>
                </div>
                
                <div id="asn-metadata" class="info-section">
                    <h3>Metadata</h3>
                    <div id="metadata-content"></div>
                </div>
            </div>
            <div class="footer" style="margin-top: 15px;">
                Data from CAIDA ASRank API | Made by rec :3
            </div>
        </div>

        <div class="footer">
            <a href="https://ipgoy.im">ipgoy.im</a> | Made by rec :3
        </div>
    </div>

    <script>
        document.getElementById('lookup-btn').addEventListener('click', lookupASN);
        document.getElementById('asn-number').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                lookupASN();
            }
        });

        async function lookupASN() {
            const asnNumber = document.getElementById('asn-number').value.trim();
            const errorBox = document.getElementById('error-box');
            const resultBox = document.getElementById('result-box');
            const loading = document.getElementById('loading');
            
            // Hide boxes and show loading
            errorBox.style.display = 'none';
            resultBox.style.display = 'none';
            loading.style.display = 'block';

            if (!asnNumber) {
                showError("Please provide an ASN number. Example: 214575");
                loading.style.display = 'none';
                return;
            }

            // Validate ASN number
            if (!/^\d+$/.test(asnNumber)) {
                showError("Invalid ASN number. Please provide a numeric ASN like 214575");
                loading.style.display = 'none';
                return;
            }

            try {
                const url = `https://api.asrank.caida.org/v2/restful/asns/${asnNumber}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`ASN ${asnNumber} not found`);
                    } else {
                        throw new Error(`API returned status ${response.status}`);
                    }
                }

                const data = await response.json();
                const asnData = data.data?.asn || {};
                
                // Display results
                document.getElementById('asn-title').textContent = `AS${asnNumber}`;
                
                // Basic info
                const countryCode = asnData.country?.iso || '';
                const flagEmoji = countryCode ? getFlagEmoji(countryCode) : '';
                const basicInfo = `
                    <div><strong>Name:</strong> ${asnData.asnName || 'N/A'}</div>
                    <div><strong>Rank:</strong> #${asnData.rank || 'N/A'}</div>
                    <div><strong>Source:</strong> ${asnData.source || 'N/A'}</div>
                    <div><strong>Country:</strong> ${flagEmoji} ${countryCode || 'N/A'}</div>
                `;
                document.getElementById('asn-basic').innerHTML = basicInfo;
                
                // Network cone
                const cone = asnData.cone || {};
                document.getElementById('cone-asns').textContent = cone.numberAsns || '0';
                document.getElementById('cone-prefixes').textContent = cone.numberPrefixes || '0';
                document.getElementById('cone-addresses').textContent = cone.numberAddresses || '0';
                
                // Peering relationships
                const degree = asnData.asnDegree || {};
                document.getElementById('degree-total').textContent = degree.total || '0';
                document.getElementById('degree-customer').textContent = degree.customer || '0';
                document.getElementById('degree-peer').textContent = degree.peer || '0';
                document.getElementById('degree-provider').textContent = degree.provider || '0';
                
                // Metadata
                const metadata = document.getElementById('metadata-content');
                metadata.innerHTML = '';
                
                if (asnData.ixp) {
                    const badge = document.createElement('span');
                    badge.className = 'badge';
                    badge.textContent = 'IXP';
                    metadata.appendChild(badge);
                }
                
                if (asnData.cliqueMember) {
                    const badge = document.createElement('span');
                    badge.className = 'badge';
                    badge.textContent = 'Clique Member';
                    metadata.appendChild(badge);
                }
                
                if (metadata.innerHTML === '') {
                    metadata.textContent = 'No additional metadata';
                }
                
                resultBox.style.display = 'block';
            } catch (error) {
                showError(`Failed to fetch ASN data: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        function getFlagEmoji(countryCode) {
            if (!countryCode) return '';
            // Convert country code to flag emoji
            return String.fromCodePoint(...[...countryCode.toUpperCase()].map(c => 0x1F1A5 + c.charCodeAt(0)));
        }

        function showError(message) {
            const errorBox = document.getElementById('error-box');
            document.getElementById('error-message').textContent = message;
            errorBox.style.display = 'block';
        }
    </script>
</body>
</html>
