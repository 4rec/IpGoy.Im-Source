async function lookupASNPeers() {
    const asnNumber = document.getElementById('asn-number').value.trim();
    const errorBox = document.getElementById('error-box');
    const resultBox = document.getElementById('result-box');
    const loading = document.getElementById('loading');
    
    // Hide boxes and show loading
    errorBox.style.display = 'none';
    resultBox.style.display = 'none';
    loading.style.display = 'block';

    if (!asnNumber) {
        showError("Please provide an ASN number. Example: 3356");
        loading.style.display = 'none';
        return;
    }

    // Validate ASN number
    if (!/^\d+$/.test(asnNumber)) {
        showError("Invalid ASN number. Please provide a numeric ASN like 3356");
        loading.style.display = 'none';
        return;
    }

    try {
        const url = `https://corsproxy.io/?url=https://api.bgpview.io/asn/${asnNumber}/peers`;
        const response = await fetch(url);
        
        if (!response.ok) {
            if (response.status === 404) {
                throw new Error(`ASN ${asnNumber} not found`);
            } else {
                throw new Error(`API returned status ${response.status}`);
            }
        }

        const data = await response.json();
        let peers = data.data?.ipv4_peers || [];
        peers = peers.concat(data.data?.ipv6_peers || []);
        
        if (peers.length === 0) {
            showError("No peers found for this ASN");
            loading.style.display = 'none';
            return;
        }
        
        // Sort by ASN number
        peers.sort((a, b) => (a.asn || 0) - (b.asn || 0));
        
        // Display results
        document.getElementById('result-title').textContent = `AS${asnNumber} Peers`;
        
        // Set ASN info
        const asnInfo = document.getElementById('asn-info');
        document.getElementById('asn-name').textContent = 
            peers[0].name || 'Unknown';
        document.getElementById('peer-count').textContent = peers.length;
        
        // Calculate relationship counts
        const relationships = {};
        for (const peer of peers) {
            const rel = peer.relationship || 'Unknown';
            relationships[rel] = (relationships[rel] || 0) + 1;
        }
        
        if (Object.keys(relationships).length > 0) {
            const relBadges = Object.entries(relationships)
                .map(([rel, count]) => 
                    `<span class="relationship-badge">${rel}: ${count}</span>`)
                .join(' ');
            document.getElementById('relationship-types').innerHTML = relBadges;
        }
        
        asnInfo.style.display = 'block';
        
        // Display peers in groups
        const peerGroupsContainer = document.getElementById('peer-groups');
        peerGroupsContainer.innerHTML = '';
        
        const peerGroups = chunkArray(peers, 10);
        
        peerGroups.forEach((group, i) => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'peer-group';
            
            const title = document.createElement('div');
            title.className = 'peer-group-title';
            title.textContent = `Peers Group ${i + 1}`;
            groupDiv.appendChild(title);
            
            group.forEach(peer => {
                const peerDiv = document.createElement('div');
                peerDiv.className = 'peer-item';
                
                const peerAsn = peer.asn || 'N/A';
                const peerName = peer.name || 'Unknown';
                const peerDesc = peer.description || '';
                const countryCode = peer.country_code ? ` (${peer.country_code})` : '';
                const relationship = peer.relationship ? 
                    `<span class="relationship-badge">${peer.relationship}</span>` : '';
                
                peerDiv.innerHTML = 
                    `<strong>AS${peerAsn}</strong> - ${peerName}${countryCode} ${peerDesc} ${relationship}`;
                groupDiv.appendChild(peerDiv);
            });
            
            peerGroupsContainer.appendChild(groupDiv);
        });
        
        resultBox.style.display = 'block';
    } catch (error) {
        showError(`Failed to fetch ASN peers: ${error.message}`);
    } finally {
        loading.style.display = 'none';
    }
}
