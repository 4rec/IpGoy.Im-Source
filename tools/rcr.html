<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random CIDR Range Generator</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .result-box {
            margin-top: 20px;
            display: none;
        }
        .error-box {
            margin-top: 20px;
            display: none;
            background-color: var(--active-link);
            color: white;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="https://ipgoy.im">Home</a>
        <a href="#">Random CIDR Range</a>
    </div>

    <div class="container">
        <h1>Random CIDR Range Generator</h1>
        
        <div class="box">
            <div class="box-title">Generator</div>
            <div class="form-group">
                <label for="cidr">CIDR Range (e.g., 5.62.62.0/23):</label>
                <input type="text" id="cidr" placeholder="Enter CIDR range...">
            </div>
            <button id="generate-btn">Generate Random IP</button>
        </div>

        <div id="error-box" class="box error-box">
            <div class="box-title">Error</div>
            <div id="error-message"></div>
        </div>

        <div id="result-box" class="box result-box">
            <div class="box-title">Random IP from CIDR Range</div>
            <table>
                <tr>
                    <td><strong>CIDR Range</strong></td>
                    <td id="cidr-display"></td>
                </tr>
                <tr>
                    <td><strong>Random IP</strong></td>
                    <td id="random-ip"></td>
                </tr>
                <tr>
                    <td colspan="2"><strong>Network Info</strong></td>
                </tr>
                <tr>
                    <td>Total IPs:</td>
                    <td id="total-ips"></td>
                </tr>
                <tr>
                    <td>Netmask:</td>
                    <td id="netmask"></td>
                </tr>
                <tr>
                    <td>Usable Range:</td>
                    <td id="usable-range"></td>
                </tr>
            </table>
        </div>

        <div class="footer">
            Made by rec :3, Hosted by xkya (nyanc4tt) | <a href="https://ipgoy.im">ipgoy.im</a>
        </div>
    </div>

    <script>
        document.getElementById('generate-btn').addEventListener('click', generateRandomIP);

        function generateRandomIP() {
            const cidr = document.getElementById('cidr').value.trim();
            const errorBox = document.getElementById('error-box');
            const resultBox = document.getElementById('result-box');
            
            // Hide both boxes initially
            errorBox.style.display = 'none';
            resultBox.style.display = 'none';

            if (!cidr) {
                showError("Please provide a CIDR range. Example: 5.62.62.0/23");
                return;
            }

            try {
                const networkInfo = parseCIDR(cidr);
                const randomIP = getRandomIP(networkInfo);
                
                // Display results
                document.getElementById('cidr-display').textContent = cidr;
                document.getElementById('random-ip').textContent = randomIP;
                document.getElementById('total-ips').textContent = networkInfo.numAddresses.toLocaleString();
                document.getElementById('netmask').textContent = networkInfo.netmask;
                document.getElementById('usable-range').textContent = `${networkInfo.firstUsable} - ${networkInfo.lastUsable}`;
                
                resultBox.style.display = 'block';
            } catch (error) {
                showError(error.message);
            }
        }

        function parseCIDR(cidr) {
            // Basic CIDR validation
            const cidrRegex = /^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/;
            if (!cidrRegex.test(cidr)) {
                throw new Error("Invalid CIDR format. Example: 5.62.62.0/23");
            }

            const [ip, prefix] = cidr.split('/');
            const prefixLength = parseInt(prefix);
            
            if (prefixLength < 0 || prefixLength > 32) {
                throw new Error("Prefix length must be between 0 and 32");
            }

            // Validate IP octets
            const octets = ip.split('.');
            if (octets.length !== 4) {
                throw new Error("Invalid IP address");
            }

            for (const octet of octets) {
                const num = parseInt(octet);
                if (num < 0 || num > 255) {
                    throw new Error("IP octets must be between 0 and 255");
                }
            }

            // Calculate network information
            const netmask = calculateNetmask(prefixLength);
            const numAddresses = Math.pow(2, 32 - prefixLength);
            const networkAddress = calculateNetworkAddress(ip, prefixLength);
            const broadcastAddress = calculateBroadcastAddress(networkAddress, prefixLength);
            
            // First usable is network + 1, last usable is broadcast - 1
            const firstUsable = incrementIP(networkAddress);
            const lastUsable = decrementIP(broadcastAddress);

            return {
                netmask,
                numAddresses,
                firstUsable,
                lastUsable,
                networkAddress,
                broadcastAddress
            };
        }

        function calculateNetmask(prefixLength) {
            let mask = 0xffffffff << (32 - prefixLength);
            return [
                (mask >>> 24) & 0xff,
                (mask >>> 16) & 0xff,
                (mask >>> 8) & 0xff,
                mask & 0xff
            ].join('.');
        }

        function calculateNetworkAddress(ip, prefixLength) {
            const ipInt = ipToInt(ip);
            const mask = 0xffffffff << (32 - prefixLength);
            return intToIp(ipInt & mask);
        }

        function calculateBroadcastAddress(networkAddress, prefixLength) {
            const networkInt = ipToInt(networkAddress);
            const hostBits = 32 - prefixLength;
            return intToIp(networkInt | ((1 << hostBits) - 1));
        }

        function getRandomIP(networkInfo) {
            const networkInt = ipToInt(networkInfo.networkAddress);
            const broadcastInt = ipToInt(networkInfo.broadcastAddress);
            
            // Generate random between network+1 and broadcast-1
            const randomInt = Math.floor(Math.random() * (broadcastInt - networkInt - 1)) + networkInt + 1;
            return intToIp(randomInt);
        }

        function ipToInt(ip) {
            return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet), 0) >>> 0;
        }

        function intToIp(int) {
            return [
                (int >>> 24) & 0xff,
                (int >>> 16) & 0xff,
                (int >>> 8) & 0xff,
                int & 0xff
            ].join('.');
        }

        function incrementIP(ip) {
            const int = ipToInt(ip);
            return intToIp(int + 1);
        }

        function decrementIP(ip) {
            const int = ipToInt(ip);
            return intToIp(int - 1);
        }

        function showError(message) {
            const errorBox = document.getElementById('error-box');
            document.getElementById('error-message').textContent = message;
            errorBox.style.display = 'block';
        }
    </script>
</body>
</html>
